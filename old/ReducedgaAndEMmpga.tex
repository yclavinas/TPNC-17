\section{The Forecast Models Using Genetic Algorithm}\label{Models}


\subsection{1-year Forecast Models}
Large and independent earthquakes, also known as mainshocks, are
followed by a wave of others earthquakes, the
aftershocks~\cite{schorlemmer2010first}. Hence there is no physical
measurement to identify mainshocks and its
aftershocks~\cite{schorlemmer2010first}, we divided the forecast
models in two groups: the ones that only forecasts mainshocks, using only GA techniques, 
and those that forecast both mainshocks and aftershocks using GA techniques and 
empirical laws, such as the modified Omori law. These laws are use to derive the 
aftershocks from a synthetic data of mainshocks. 

All classes forecast earthquakes with magnitude greater than 3.0 for every scenario proposed.

\subsection{Mainshock Models}\label{mainshocksMethods}
There are two mainshock models. The ones generated by the GAModel and 
the ones generated by the ReducedGAModel.



\paragraph{\textbf{Genome Representation}}\label{genomeReduced}
The genome is a list of ordered pairs. The first element of the pair are the coordinates of a bin in the model. The second element of the pair is a number that indicates an earthquake occurrence estimate for this bin.

To calculate the number of elements of the individual we use the real data from the prior 5 years and create a list of every bin that had events in it.

Each individual is a list of a sub-region of the forecast model. This list initially refers to bins where earthquake events happened in the past. During a execution of the ReducedGAModel, the list may refer to positions that never had occurrences before. Each element of the list, a gene, also contains one real value between [0,1). In the initial population, these values are sampled from a uniform distribution and they are randomly generated. When needed, every real value is converted to a integer forecast by the same Algorithm~\ref{inversePoisson}, as in the GAModel.

To generate the forecast model we need to do an intermediate step. We map every location from the list with a bin in the forecast model.

The genome size is usually smaller than the one used in the GAModel and the Emp-GAModel, once the amount of sub-regions where earthquakes with magnitude above 3.0 happened for any given area is smaller then the total number of genes of the individual.

To illustrate, we give the following example. Lets consider that there are 10 bins with occurrences in Kanto in the last 5 years. It will make the GA start searching for good values for only those 10 bins, leaving the other 2015 bins empty, representing zero occurrence. It is important to highlight that in the worst case, it will make the same amount of searches as the GAModel. The final forecast model will maintain the amount of bins with occurrence, but the number of events for every bin and their location may change.


\paragraph{\textbf{Evolutionary Operators}}\label{ReducedOperators}
All operators in the ReducedGAModel are the same as the operators of the GAModel, except the mutation function. We use a simple mutation operator which samples entirely two new values, both sampled from uniform distributions. The first, is a new real value from [0,1) and the second one, a new integer value from [0,$x$), where $x$ is the maximum amount of bins a model can have in the target region. For the parameters see Table~\ref{GAParameters5.1}.

As in the GAModel, the chance of applying both mutation operator function and crossover operator are independent and they may or may not be used.

\subsection{Mainshock+Aftershock Models}
%TODO: add the var right values and "faixa"
The mainshock and aftershock methods are a two-step methods. The first step is as defined for the mainshocks methods, therefore, we first use GA techniques to obtain a synthetic mainshock data. The second step is to use seismological empirical equations to obtain the aftershocks from the mainshocks.


Hence earthquakes cluster in space and inspired by the space-time epidemic-type aftershock sequence (ETAS), we proposed two methods, called Emp-GAModel and Emp-ReducedGAModel. They represent the idea of associating the GA with seismological empirical equations. They are described as:

\begin{equation}\label{reducedgamodel}
	\Lambda(t,x,y,M|\Upsilon_t) = \lambda(t,x,y|\Upsilon_t)J(M)
\end{equation}

That can be expanded to:

\begin{equation}\label{emp-model}
 \Lambda(t,x,y|\Upsilon_t) = [\mu(x,y) + \displaystyle\sum_{t_i \in t} K(M_i)g(t-t_i)P(x,y)]J(M)
\end{equation}
%TODO: explicar o Upsilon

 these methods use $\mu(x,y)$ as defined for the mainshock methods, see~\ref{mainshocksMethods}. It is calculated as an expected number of earthquakes for every bin in the target region, given that $\Upsilon_t$ is the earthquake observation data up to time $t$.

\subsubsection{Empirical Equations}

The Omori law, $g(t)$, which is considered one empirical formula of great success~\cite{zhuang2004analyzing}~\cite{utsu1995centenary}~\cite{omori1895after}, is a power law that relates the earthquake occurrence and its magnitude with the decay of aftershocks activity with time. For this approach we used the probability density function (PDF) form of the modified Omori law~\cite{zhuang2004analyzing}:

\begin{equation}\label{omori}
	g(t)= \dfrac{(p-1)}{c(1+ \dfrac{t}{c})^(-p)}
\end{equation}

The variable $p$ is a index of this equation and the variable $c$ is a constant, given in days. In the paper~\cite{utsu1995centenary}, Utsu summarise most of the studies in Japan and described the range for these variables. For $p$ the range is between 0.9 and 1.4 and for $c$ 0.003 and 0.3 days. These values were based on the Davidon-Fletcher-Powell optimisation procedure and used in ETAS~\cite{utsu1995centenary}. Also there is the variable $t$ that is the time limit to when a mainshock may influence the cause a aftershock.

Based on paper~\cite{yamanaka1990scaling}, we set the values of $1.3$ for $p$ and $0.003$ for $c$ for our experiments. We set the time interval $t$ between a mainshock and its aftershocks at one month. In this paper, Yamanaka et al. say that if the $t$ value is too short, the number of aftershocks is too small, but if it is too big, we may also consider background activity and suggest the use of a 30 days period.

For $K(M_i)$, the total amount of triggered events, we count aftershocks within a given area, $A$, using the following formula, where $M_c$ is the magnitude threshold, with $M_c=3.0$:

\begin{equation}\label{triggered}
 K(M_i) = A\ exp([\alpha(M_i-M_c)])
\end{equation}

In the paper~\cite{ogata2006space}, it states that $\alpha$ should be equal to the inverse of the magnitude of an event, or $magnitude^{-1}$. To obtain $A$, the following equation from~\cite{yamanaka1990scaling}, was used:

\begin{equation}
A = e^{(1.02M -4)}
\end{equation}

With the $K(Mi)$ and $g(t)$, the PDF Omori, equations it is possible to calculate the total number of earthquakes. For that we must sum the product of the equations, varying $t$:

\begin{equation}
\displaystyle\sum_{t_i \in t} K(M_i)g(t-t_i)
\end{equation}

This result will lead to a number of aftershocks related to a single mainshock. Then, we can use the $P(x,y)$ equation to distribute the aftershock to the bins near the mainshocks position.  $P(x,y)$ calculates the position of the aftershocks with base on the origin of the mainshock. It is a simple space distributing function, that allocates the aftershocks in one of the following positions: upper, lower, left or right. It runs for a number of steps, getting further from the origin at each step or as when there are no more events to be allocated. $P(x,y)$ can be split into 4 equations, one for each position:

\begin{subequations}
\begin{gather*}
        model[x+y] = (aftershocks-[model[x]-2*x])/4;\\
        model[x-y] = (aftershocks-[model[x]-2*x])/4;\\
        model[x-y*row] = (aftershocks-[model[x]-2*x])/4;\\
        model[x+y*row] = (aftershocks-[model[x]-2*x])/4
\end{gather*}
\end{subequations}


and lastly, the $J(M)$ is obtained by using the function etasim, from the SAPP \textit{R} package~\cite{webSapp} that simulates magnitude by Gutenberg-Richterâ€™s Law.

The equations are used following the next algorithm~\ref{algoEquations}:

\begin{algorithm}[H]\label{algoEquations}
	\caption{Obtain an aftershock distribution from empirical laws}
	\begin{algorithmic}	
		\STATE function emp-equations(model,year,J(M),time)
		\STATE limit(model) \COMMENT{Limit the value of a bin to 12}
		\STATE aftershock = 0
		\STATE model  = attributeMagnitudeToEarthquake(model, J(M) )
		\STATE magnitudes = getMagnitudeMainshock(model)
		
		\WHILE{magnitude in magnitudes} 
			\WHILE{t in time} 
				\STATE aftershocks = g(t)*K(magnitude)
			\ENDWHILE
		\ENDWHILE
		\STATE aftershockSpacialDistribuition(model, aftershock) \COMMENT{P(x,y) is a subrotine}
		\RETURN model
	\end{algorithmic}
\end{algorithm}

\subsubsection{Emp-GAModel}\label{emp-gamodel}
The Emp-GAModel is a specialisation of the GAModel. This is achieved by the use of empirical equations after the forecast is provided. This means that the its genome representation are the same as in the GAModel.
\paragraph{\textbf{Genome Representation}}
The genome representation is the same as in the GAModel, Section~\ref{genomeGA}.

\paragraph{\textbf{Fitness Function}}
The fitness function is the same as in the GAModel,Section~\ref{fitGA}, and the ReducedGAModel.
\paragraph{\textbf{Evolutionary Operators}}
The Emp-GAModel use the same combination of operators that the GAModel. For more explanation, please see the Section~\ref{gaOperators}.

\subsubsection{Emp-ReducedGAModel}\label{emp-reducedgamodel}
The Emp-ReducedGAModel is a specialisation of the ReducedGAModel. This is achieved by the use of empirical equations after the forecast is provided. This means that the its genome representation are the same of ReducedGAModel.

\paragraph{\textbf{Genome Representation}}
The genome representation is the same as in the ReducedGAModel,Section~\ref{genomeReduced}. 

\paragraph{\textbf{Fitness Function}}
The fitness function is the same as for all methods,Section~\ref{fitGA}. Here is also important to generate the forecast model by applying the map function on the individual as in the last Section,~\ref{genomeReduced}.

\paragraph{\textbf{Evolutionary Operators}}
The Emp-ReducedGAModel use the same combination of operators that the ReducedGAModel. For more explanation, please see~\ref{gaOperators}.


